<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8">

		<title>Atelier : PHP Evaluator</title>

		<meta name="description" content="Slides utilisés comme support de mon atelier « créer un site pour tester du code sous plusieurs versions de PHP, avec Docker » à Lyon, le 30 avril 2016">
		<meta name="author" content="Pascal MARTIN">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/simple.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="css/custom.css">
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<script src="lib/js/jquery.min.js" type="text/javascript"></script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>
	<body>
		<div class="reveal">
			<div class="slides">

                <!--
                <section id="info-notes-presentateur">
                    <p>
                        <strong>Appuyez sur <kbd>[s]</kbd> pour ouvrir les <em>notes présentateur</em> dans une nouvelle fenêtre.</strong>
                    </p>
                    <aside class="notes">
                        <p>Je vais essayer d'ajouter ici, pour certains slides, des points que j'ai pu donner à l'oral lors de la présentation et/ou qui ne sont pas explicitement écrits sur les slides — afin de les rendre plus utiles aux lecteurs qui n'auraient pas assisté à la présentation.</p>
                        <p>Le style sera volontairement un peu <em>oral</em>, se rapprochant un peu de ce qui s'est dit lors de la présentation <em>live</em>.</p>
                    </aside>
                </section>

                <section id="use-space-key">
                    <p>
                        <strong>Utilisez la touche <kbd>[ESPACE]</kbd><br />pour passer au slide <em>suivant</em>.</strong>
                    </p>
                </section>
                -->

                <section>

                    <section>
                        <h1>Atelier</h1>
                        <h2>
                            Créer un site pour tester du code sous plusieurs versions de PHP, avec Docker
                        </h2>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Merci !</h2>
                        <ul>
                            <li>Norsys, pour son accueil</li>
                            <li>
                                AFUP Lyon (<a href="https://twitter.com/AFUP_Lyon">@AFUP_Lyon</a>), pour l'organisation
                                <ul>
                                    <li>Adrien - <a href="https://twitter.com/agallou">@agallou</a></li>
                                    <li>Benoit - <a href="https://twitter.com/benoit_leveque">@benoit_leveque</a></li>
                                </ul>
                            </li>
                            <li class="fragment">Vous, levés de bon matin !</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Pascal MARTIN</h2>
                        <p>Je suis preneur de vos retours&nbsp;!</p>
                        <ul>
                            <li><a href="mailto:contact@pascal-martin.fr">contact@pascal-martin.fr</a></li>
                            <li><a href="https://twitter.com/pascal_martin">@pascal_martin</a></li>
                            <li><a href="https://blog.pascal-martin.fr">blog.pascal-martin.fr</a></li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>PHPTour 2016</h2>
                        <ul>
                            <li>23 et 24 mai</li>
                            <li>Clermont-Ferrand</li>
                            <li><a href="http://event.afup.org/">event.afup.org</a></li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Organisation</h2>
                        <ul>
                            <li>3h + pause</li>
                            <li>Plusieurs <em>slots</em> + ou - successifs</li>
                            <li><em>Blah blah</em> théorique ? Pratiquons !</li>
                            <li>Au besoin : une <em>proposition</em> de code sur github</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <!-- introduction -->
                </section>


                <section>
                    <section>
                        <h1>Slot-01</h1>
                        <h2>Introduction, premiers pas</h2>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Objectifs</h2>
                        <ul>
                            <li>Objectifs de l'atelier</li>
                            <li>Composants requis et leur installation</li>
                            <li>Docker, premiers pas</li>
                            <li>Exécuter du code PHP, y compris dans un docker</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Oops ;-(</h2>
                        <p>Oubli dans le provisionning vagrant</p>
                        <pre><code data-trim>
usermod -aG docker vagrant
                        </code></pre>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Une application</h2>
                        <ul>
                            <li>Tester du code PHP</li>
                            <li>Sous plusieurs versions du langage</li>
                            <li>En <em>isolation</em></li>
                            <li>Via un <em>site web</em></li>
                            <li>Affichage des sorties + code statut</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Idée générale</h2>
                        <ul>
                            <li>
                                Une VM, VirtualBox
                                <ul>
                                    <li>Un serveur capable de faire tourner Docker</li>
                                    <li>Tout le monde sous Linux, setup simplifié</li>
                                    <li>Vagrant : + simple que <em>à la main</em></li>
                                </ul>
                            </li>
                            <li>nginx + PHP</li>
                            <li>Page Web / formulaire</li>
                            <li>Exécution : docker</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Pas <em>parfait</em></h2>
                        <ul>
                            <li>Pas docker <em>pour tout</em></li>
                            <li>Quelques raccourcis</li>
                            <li>Pas encore une application utilisable en production</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Installation</h2>
                        <p>Provisionning Vagrant</p>
                        <pre><code data-trim>
vagrant-files/vagrant-provision.sh
                        </code></pre>
                        <pre><code data-trim>
vagrant up
vagrant ssh
                        </code></pre>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Docker</h2>
                        <pre><code data-trim>
docker pull image:tag
docker pull debian:jessie
docker pull php:7.0-cli
                        </code></pre>
                        <pre><code data-trim>
docker images
docker ps
                        </code></pre>
                        <pre><code data-trim>
docker run [-i] [-t] [--rm] image:tag commande
docker run --rm debian:jessie ls -l /
docker run -it --rm debian:jessie /bin/bash
                        </code></pre>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Exécuter du PHP</h2>
                        <pre><code data-trim>
php -r 'var_dump(PHP_VERSION);'
                        </code></pre>
                        <pre><code data-trim>
echo '&lt;?php echo PHP_VERSION, "\n"; ?&gt;' | php
                        </code></pre>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Exécuter du PHP</h2>
                        <pre><code data-trim>
docker run php:7.0-cli php -r 'var_dump(PHP_VERSION);'
                        </code></pre>
                        <pre><code data-trim>
echo '&lt;?php echo PHP_VERSION, "\n"; ?&gt;' | docker run -i php:7.0-cli php
                        </code></pre>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <!-- slot-01 -->
                </section>


                <section>
                    <section>
                        <h1>Slot-02</h1>
                        <h2>Exécuter du PHP depuis PHP-FPM</h2>
                        <aside class="notes">
                            ul>li*2
                        </aside>
                    </section>

                    <section>
                        <h2>Objectifs</h2>
                        <ul>
                            <li>Un premier exemple d'exécution de PHP via docker, depuis FPM</li>
                            <li>Une classe qui exécute du code PHP via un container docker</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Exécuter un processus</h2>
                        <p>Depuis une page PHP / Web</p>
                        <p>Fonction <code>passthru()</code></p>
                        <ul>
                            <li>Code PHP en paramètre : <code>php -r</code></li>
                            <li>Code PHP sur <code>stdin</code></li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Exécuter un processus</h2>
                        <p>Fonction <code>proc_open()</code></p>
                        <ul>
                            <li>+ souple</li>
                            <li>+ de contrôlle sur les <code>stdin</code>, <code>stdout</code>, <code>stderr</code></li>
                            <li>récupération du code statut</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Exécuter un processus</h2>
                        <p>Classe PHP qui encapsule <code>proc_open()</code></p>
                        <pre class="fragment"><code data-trim>
workshop/www/02/docker-php-04.php
workshop/www/02/evaluator.php
                        </code></pre>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>


                    <section>
                        <h2>Sur Github</h2>
                        <p><a href="https://github.com/pmartin/php-evaluator/">pmartin/php-evaluator</a></p>
                        <p><a href="https://github.com/pmartin/php-evaluator/tree/workshop-02">→ <code>tree/workshop-02</code></a></p>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>
                    <!-- slot-02 -->
                </section>


                <section>
                    <section>
                        <h1>Slot-03</h1>
                        <h2>Une interface web pour exécuter du PHP</h2>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Objectifs</h2>
                        <ul>
                            <li>Un formulaire avec un <code>&lt;textarea&gt;</code> pour saisir ce code</li>
                            <li>Un script de branchement</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Formulaire</h2>
                        <ul>
                            <li><code>index.php</code></li>
                            <li><code>&lt;textarea&gt;</code> + <code>submit</code></li>
                            <li><code>POST</code> vers <code>eval.php</code></li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Script d'exécution</h2>
                        <ul>
                            <li><code>eval.php</code></li>
                            <li>Reçoit du code en <code>POST</code> et l'exécute</li>
                            <li>
                                Affiche :
                                <ul>
                                    <li>Code statut</li>
                                    <li>Sortie standard</li>
                                    <li>Sortie d'erreurs</li>
                                </ul>
                            </li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>


                    <section>
                        <h2>Sur Github</h2>
                        <p><a href="https://github.com/pmartin/php-evaluator/">pmartin/php-evaluator</a></p>
                        <p><a href="https://github.com/pmartin/php-evaluator/tree/workshop-03">→ <code>tree/workshop-03</code></a></p>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>
                    <!-- slot-03 -->
                </section>


                <section>
                    <section>
                        <h1>Slot-04</h1>
                        <h2>Construire notre propre image</h2>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Objectifs</h2>
                        <ul>
                            <li>Concept de <code>Dockerfile</code> + commande <code>docker build</code></li>
                            <li>Construction <em>simple</em> en utilisant des paquets existant : debian jessie</li>
                            <li>Utilisation dans notre application</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Dockerfile</h2>
                        <p>Décrit la construction d'une image</p>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Dockerfile</h2>
                        <pre><code data-trim>
FROM debian:jessie

MAINTAINER Pascal MARTIN &lt;contact@pascal-martin.fr&gt;

RUN apt-get update &amp;&amp; apt-get install -y php5-cli
                        </code></pre>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Construction</h2>
                        <pre><code data-trim>
docker build
                        </code></pre>
                        <pre class="fragment"><code data-trim>
docker build --rm --tag=php-jessie .
                        </code></pre>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Utiliser notre image</h2>
                        <pre><code data-trim>
docker run --rm php-jessie php --version
                        </code></pre>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Branchement dans notre application</h2>
                        <p>Liste d'images à utiliser</p>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>PHP 7.0 vs 5.6</h2>
                        <pre><code data-trim>
printf("Version de PHP utilisée : %s", PHP_VERSION);
                        </code></pre>
                        <pre class="fragment"><code data-trim>
function hello(string $who)
{
    printf("Hello, %s!", $who);
}

hello("World");
                        </code></pre>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>


                    <section>
                        <h2>Sur Github</h2>
                        <p><a href="https://github.com/pmartin/php-evaluator/">pmartin/php-evaluator</a></p>
                        <p><a href="https://github.com/pmartin/php-evaluator/tree/workshop-04">→ <code>tree/workshop-04</code></a></p>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>
                    <!-- slot-04 -->
                </section>


                <section>
                    <section>
                        <h1>Slot-05</h1>
                        <h2>Sécuriser un minimum</h2>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Objectifs</h2>
                        <ul>
                            <li>Laisser n'importe qui exécuter du code = risque</li>
                            <li>Sécurisation au niveau de PHP : quelques points de configuration + sécurisée</li>
                            <li>Sécuration au niveau de docker : quelques limites qu'on peut mettre en place</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>


                    <section>
                        <h2>Sur Github</h2>
                        <p><a href="https://github.com/pmartin/php-evaluator/">pmartin/php-evaluator</a></p>
                        <p><a href="https://github.com/pmartin/php-evaluator/tree/workshop-05">→ <code>tree/workshop-05</code></a></p>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>
                    <!-- slot-05 -->
                </section>


                <section>
                    <section>
                        <h1>Slot-06</h1>
                        <h2>Construire une version personnalisée de PHP</h2>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Objectifs</h2>
                        <ul>
                            <li>Mais pourquoi ?</li>
                            <li>Un docker pour construire + exécuter ?</li>
                            <li>Un docker pour construire + un autre pour exécuter</li>
                            <li>Ajouter notre nouvelle version de PHP à celles déjà exécutées plus haut</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>


                    <section>
                        <h2>Sur Github</h2>
                        <p><a href="https://github.com/pmartin/php-evaluator/">pmartin/php-evaluator</a></p>
                        <p><a href="https://github.com/pmartin/php-evaluator/tree/workshop-06">→ <code>tree/workshop-06</code></a></p>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>
                    <!-- slot-06 -->
                </section>


                <section>
                    <section>
                        <h1>Slot-07</h1>
                        <h2>Exécution du code en asynchrone</h2>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Objectifs</h2>
                        <ul>
                            <li>Une mini-introduction à ReactPHP et plus particulièrement <code>reactphp/child-process</code></li>
                            <li>Parallélisation de l'exécution du code sur les différentes images</li>
                            <li>Un gain de temps ?</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>


                    <section>
                        <h2>Sur Github</h2>
                        <p><a href="https://github.com/pmartin/php-evaluator/">pmartin/php-evaluator</a></p>
                        <p><a href="https://github.com/pmartin/php-evaluator/tree/workshop-07">→ <code>tree/workshop-07</code></a></p>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>
                    <!-- slot-07 -->
                </section>


                <section>
                    <section>
                        <h1>Conclusion</h1>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <h2>Idées pour la suite...</h2>
                        <ul>
                            <li>Persistance : MySQL, Redis, ...</li>
                            <li>
                                Exécuter le code en arrière-plan
                                <ul>
                                    <li>Point de vue de l'utilisateur</li>
                                    <li>Afficher les résultats au fur et à mesure de leur arrivée</li>
                                </ul>
                            </li>
                            <li>File de jobs : RabbitMQ ?</li>
                            <li>Déploiement</li>
                            <li>Montée en charge</li>
                            <li>...</li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <section>
                        <p>Je suis preneur de vos retours&nbsp;!</p>
                        <ul>
                            <li><a href="mailto:contact@pascal-martin.fr">contact@pascal-martin.fr</a></li>
                            <li><a href="https://twitter.com/pascal_martin">@pascal_martin</a></li>
                            <li><a href="https://blog.pascal-martin.fr">blog.pascal-martin.fr</a></li>
                        </ul>
                        <aside class="notes">
                            ul>li*3
                        </aside>
                    </section>

                    <!-- conclusion -->
                </section>

            </div> <!-- slides -->

            <!--
			<div id="footer" class="presentation-details">
                <p>
                    Pascal MARTIN, <a href="http://twitter.com/pascal_martin">@pascal_martin</a> &nbsp;— Avril 2016
                </p>
            </div>
            -->
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
                progress: true,
                history: true,
                center: true,
                theme: 'simple',
                transition: 'none', // default/cube/page/concave/zoom/linear/fade/none
                width: 1280,
                height: 1024,
                slideNumber: false,

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

			// Changement de footer pour afficher les credits de la photo du slide courant
            Reveal.addEventListener('slidechanged', function (event) {
                if ($('aside.notes p.img-attribution', event.currentSlide).length > 0) {
                    $('#footer p').html($('aside.notes p.img-attribution', event.currentSlide).html());
                }
                else {
                    $('#footer p').html("");
                }
            });

        	/*
            // Navigation à la souris
            window.addEventListener("mousedown", handleClick, false);
            window.addEventListener("contextmenu", handleClick, false);
            function handleClick(e) {
                e.preventDefault();
                if(e.button === 0) Reveal.next();
                if(e.button === 2) Reveal.prev();
            }
            //*/
		</script>
	</body>
</html>
